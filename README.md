# hosting
Procedimientos para realizar la creación de un hosting con servicio web, ftp y base de datos.

Committeros: Manuel Franco, Maria Romero y Juan Jose Lopez

- [x] Instalación de Servidor Web.
- [x] Instalación de Servidor FTP.
- [x] Instalación de Servidor MariaDB.
- [x] Instalación de Servidor DNS.
- [ ] Autenticación con MariaDB.
- [x] Instalación de PHPmyAdmin.
- [ ] Creación de Aplicación Web.
- [ ] Cuotas con volúmenes lógicos.
- [ ] Gestor Grafico FTP net2ftp.
- [ ] Estadísticas Web con awstat.
- [ ] Subir ficheros mediante repositorio gitHub.
- [ ] Creación de script de Alta/Baja de usuario y cambio de contraseña.


Se realizará en un entorno de prueba para depurar su funcionamiento y acto seguido se trasladará a un entorno de producción.

- En el entorno de prueba se realizará en una máquina.

	- Máquina 1 (Anakin "172.22.200.111"): Tendrá instalado todos los servicios.

- En el entorno de producción se realizara en dos máquinas, en las cuales los servicios se dividiran de la siguiente forma:

	- Máquina Obi-Wan: Tendrá los servicios de cara al exterior como el servidor web, el ftp o el servidor DNS.
	- Máquina Yoda: Tendrá la base de datos en la red interna, está no será accesible desde el exterior.


# Instalación del servidor Apache2:

`apt install apache2`

Una vez tengamos instalado Apache2, vamos a configurar la automatización de creación de virtualhost en apache2, esto se hará de la siguiente manera:


Tendremos un proceso que estará mirando a la carpeta donde se subirán los archivos por FTP y cuando tengamos una nueva carpeta con el nombre de usuario se creará automáticamente.

# FTP
## Instalación
`apt-get install proftpd`

## Configuración
La configuracion de proftpd se basa en la modificacion del fichero que se encuentra en /etc/proftpd/proftpd.conf 

# mariaDB
## Instalación
`apt install mariadb-server`

## Configuración
Para crear un usuario y no tener que usar siempre root, nos conectamos con este usuario y creamos el nuevo:

~~~
MariaDB [(none)]> g
mysql -u root -p
MariaDB [(none)]> grant all privileges on *.* to 'auth'@'localhost' identified by '*****' with grant option;
~~~

Lo siguiente es crear la base de datos, las tablas e insertar datos:
~~~
mysql -u auth -p
MariaDB [(none)]> create database users
MariaDB [(none)]> use users
MariaDB [users]> create table testusers
    -> (
    -> username char(20) NOT NULL,
    -> password char(70) NOT NULL,
    -> email char(70)
    -> );
MariaDB [users]> insert into testusers values('maria.romero', '****', 'm.romeroangulo@gmail.com')`
~~~

# DNS Bind9
## Instalación
`apt-get install bind9`

## Configuración
La configuración de Bind9 se realiza de la siguiente forma

- Primero se realiza la configuracion de las zonas y para ello la tendremos que indicar en el fichero llamado named.conf.local que se encuentra en /etc/bind.
~~~
nano /etc/bind/named.conf.local 
	
	//
	// Do any local configuration here
	//

	// Consider adding the 1918 zones here, if they are not used in your
	// organization
	//include "/etc/bind/zones.rfc1918";

	zone "elultimohosting.com" {

	type master;

	file "/var/cache/bind/db.elultimohosting.com";

	};


	zone "22.172.in-addr.arpa" {

	type master;

	file "/var/cache/bind/db.22.172";

	};
~~~

- Acto seguido tendremos que modificar en el mismo directorio el fichero llamado named.conf.options y en ese fichero tendremos que generar las lineas forwarders y en esas lineas tendremos que indicar la dirección ip de nuestro proveedor DNS para que en el caso en el que tenga que hacer una petición a un nombre que no tenga nuestro DNS no tenga que dirigirse a los RootServer si no que le pregunte a este servidor.
~~~
nano /etc/bind/named.conf.options
	
	forwarders {
        	        192.168.102.2;
        	};

~~~

- Para "finalizar", lo ultimo que tendremos que definir en el aspecto de configuracion de DNS es el fichero de zonas, este fichero lo que realizara es indicar que rango de ip no deseamos que realice la busqueda fuera de su propia zona en la que tiene autoridad, lo que quiere decir, que la linea que tengamos comentada, el rango que tenga indicado en dicha linea lo unico que realizara es, no buscar fuera de las zonas que tiene el DNS definido.
~~~
nano /etc/bind/zones.rfc1918 
	
	#zone "22.172.in-addr.arpa"  { type master; file "/etc/bind/db.empty"; };

~~~

- En el momento que tengamos todos los parametros definidos correctamente procederemos a crear las zonas que hemos indicando en el fichero editado anteriormente llamado named.conf.local. Estos ficheros tendremos que crearlo en la ruta que hemos definido en la zona del fichero, lo que viene siendo que tendremos que crear los fichero en la ruta /var/cache/bind/.

### Zona Directa
~~~
nano /var/cache/bind/db.elultimohosting.com

	; BIND reverse data file for empty rfc1918 zone
	;
	; DO NOT EDIT THIS FILE - it is used for multiple zones.
	; Instead, copy it, edit named.conf, and use that copy.
	;
	$TTL 86400
	@ IN SOA anakin.elultimohosting.com. admin.email. (
	                5 ; Serial
	                604800 ; Refresh
	                86400 ; Retry
	                2419200 ; Expire
        	        86400 ) ; Negative Cache TTL
	;
	@ IN NS anakin.elultimohosting.com.

	$ORIGIN elultimohosting.com.
	anakin IN A 172.22.200.111

~~~

### Zona Inversa
~~~
nano /var/cache/bind/db.22.172
	; BIND reverse data file for empty rfc1918 zone
	;
	; DO NOT EDIT THIS FILE - it is used for multiple zones.
	; Instead, copy it, edit named.conf, and use that copy.
	;
	$TTL 86400
	@ IN SOA anakin.elultimohosting.com. admin.email. (
	                5 ; Serial
	                604800 ; Refresh
	                86400 ; Retry
	                2419200 ; Expire
        	        86400 ) ; Negative Cache TTL
	;
	@ IN NS anakin.elultimohosting.com.
	$ORIGIN 22.172.in-addr.arpa.
	111.200 IN PTR  anakin.elultimohosting.com.
~~~

Cuando ya tengamos toda esta configuración procederemos a realizar el reinicio del servicio para aplicar todos estos cambios y asi tener nuestro servidor DNS operativo con una configuración basica de cara a la configuración de las zonas del DNS.

`systemctl status bind9`

# phpMyAdmin
## Instalación
`apt install phpmyadmin`

Durante la instalación nos da la opción de instalarlo en el momento o luego manualmente. La primera opción es la más cómoda si ya tenemos configurado todo lo de mariaDB. Nos pide una clave para el usuario administrador de phoMyAdmin y si queremos que vaya sobre apache o httpd.

## Configuración
Lo primero es deshabilitar el sitio por defecto que trae apache2:
`a2dissite 000-default`

Ahora creamos el virtual host para phpMyAdmin:
~~~
cd /etc/apache2/sites-availables
nano phpmyadmin.conf
<VirtualHost *:80>
        ServerName mysql.elultimohosting.com

        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html/
        RedirectMatch permanent ^/$ "/phpmyadmin/"

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>
~~~

Se ha puesto un redirect para que cuando entremos en el sitio, vaya directamente a phpMyAdmin.
Una vez creado el fichero hay que habilitar el sitio
`a2ensite phpmyadmin.conf`

